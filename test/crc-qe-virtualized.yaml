---
apiVersion: tekton.dev/v1beta1
kind: Pipeline
metadata:
  name: integration-test
spec:
  description: >-
    This pipeline will run the testing for openshift local on 
    a specific linux version based on nested virtualization
  params:
    - name: SNAPSHOT
      type: string
  tasks:
    - name: get-image
      taskSpec:
        params:
          - name: SNAPSHOT
            type: string
        results:
          - name: output-image
        steps:
          - name: get
            image: quay.io/konflux-ci/konflux-test:stable
            env:
              - name: SNAPSHOT
                value: $(params.SNAPSHOT)
            script: |
              #!/bin/sh
              echo $SNAPSHOT
              COMPONENT_CONTAINER_IMAGE=$(jq -r --arg component_name "crc-release" '.components[] | select(.name == $component_name) | .containerImage' <<< "${SNAPSHOT}")
              echo ${COMPONENT_CONTAINER_IMAGE}
              echo -n "${COMPONENT_CONTAINER_IMAGE}" | tee $(results.output-image.path)
      params:
        - name: SNAPSHOT
          value: $(params.SNAPSHOT)  

    - name: get-content
      taskSpec:
        params:
          - name: image-name
            type: string
        steps:
          - name: check-folder
            image: $(params.image-name)
            script: |
              #!/bin/sh
              ls /opt
              echo "cheking folder"
              ls /opt/2.49.0
      params:
        - name: image-name
          value: $(tasks.get-image.results.output-image)

